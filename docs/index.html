<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@icazemier/gibbons-mongodb</title><meta name="description" content="Documentation for @icazemier/gibbons-mongodb"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@icazemier/gibbons-mongodb</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@icazemier/gibbons-mongodb</h1></div><div class="tsd-panel tsd-typography"><img src="https://raw.githubusercontent.com/icazemier/gibbons/master/gibbons.png" width="200" />
<h1 id="gibbons-for-mongodb" class="tsd-anchor-link">Gibbons for MongoDB<a href="#gibbons-for-mongodb" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Manage user groups and permissions in <a href="https://www.mongodb.com/">MongoDB</a> using bitwise operations with <a href="https://github.com/icazemier/gibbons">Gibbons</a>. Store and query thousands of permissions using minimal space.</p>
<h2 id="install" class="tsd-anchor-link">Install<a href="#install" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@icazemier/gibbons-mongodb</span>
</code><button type="button">Copy</button></pre>

<h2 id="quick-start" class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="1-create-a-config-file" class="tsd-anchor-link">1. Create a config file<a href="#1-create-a-config-file" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>.gibbons-mongodbrc.json</code> in your project root:</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;dbName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;myapp&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;permissionByteLength&quot;</span><span class="hl-1">: </span><span class="hl-4">256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;groupByteLength&quot;</span><span class="hl-1">: </span><span class="hl-4">256</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;mongoDbMutationConcurrency&quot;</span><span class="hl-1">: </span><span class="hl-4">10</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;dbStructure&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;user&quot;</span><span class="hl-1">: { </span><span class="hl-3">&quot;collectionName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;users&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;group&quot;</span><span class="hl-1">: { </span><span class="hl-3">&quot;collectionName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;groups&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;permission&quot;</span><span class="hl-1">: { </span><span class="hl-3">&quot;collectionName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;permissions&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="2-seed-the-database" class="tsd-anchor-link">2. Seed the database<a href="#2-seed-the-database" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="bash"><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-2">gibbons-mongodb</span><span class="hl-1"> </span><span class="hl-2">init</span><span class="hl-1"> </span><span class="hl-5">--uri</span><span class="hl-1"> </span><span class="hl-2">mongodb://localhost:27017</span>
</code><button type="button">Copy</button></pre>

<p>This creates pre-allocated permission and group slots. With 256 bytes you get 2,048 slots each.</p>
<h3 id="3-use-it" class="tsd-anchor-link">3. Use it<a href="#3-use-it" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">GibbonsMongoDb</span><span class="hl-1">, </span><span class="hl-7">ConfigLoader</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@icazemier/gibbons-mongodb&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">config</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">ConfigLoader</span><span class="hl-1">.</span><span class="hl-0">load</span><span class="hl-1">();</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">gibbonsDb</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">GibbonsMongoDb</span><span class="hl-1">(</span><span class="hl-2">&quot;mongodb://localhost:27017&quot;</span><span class="hl-1">, </span><span class="hl-7">config</span><span class="hl-1">);</span><br/><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">initialize</span><span class="hl-1">();</span><br/><br/><span class="hl-9">// Create permissions</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">editPerm</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">allocatePermission</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;posts.edit&quot;</span><span class="hl-1"> });</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">deletePerm</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">allocatePermission</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;posts.delete&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-9">// Create a group and assign permissions</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">admins</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">allocateGroup</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;Admins&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">subscribePermissionsToGroups</span><span class="hl-1">(</span><br/><span class="hl-1">    [</span><span class="hl-7">admins</span><span class="hl-1">.</span><span class="hl-7">gibbonGroupPosition</span><span class="hl-1">],</span><br/><span class="hl-1">    [</span><span class="hl-7">editPerm</span><span class="hl-1">.</span><span class="hl-7">gibbonPermissionPosition</span><span class="hl-1">, </span><span class="hl-7">deletePerm</span><span class="hl-1">.</span><span class="hl-7">gibbonPermissionPosition</span><span class="hl-1">]</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-9">// Create a user and assign to group</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">user</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">createUser</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;Alice&quot;</span><span class="hl-1">, </span><span class="hl-7">email:</span><span class="hl-1"> </span><span class="hl-2">&quot;alice@example.com&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">subscribeUsersToGroups</span><span class="hl-1">({ </span><span class="hl-7">_id:</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1">.</span><span class="hl-7">_id</span><span class="hl-1"> }, [</span><span class="hl-7">admins</span><span class="hl-1">.</span><span class="hl-7">gibbonGroupPosition</span><span class="hl-1">]);</span><br/><br/><span class="hl-9">// Check permissions</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">canEdit</span><span class="hl-1"> = </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">validateUserPermissionsForAnyPermissions</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">user</span><span class="hl-1">.</span><span class="hl-7">permissionsGibbon</span><span class="hl-1">,</span><br/><span class="hl-1">    [</span><span class="hl-7">editPerm</span><span class="hl-1">.</span><span class="hl-7">gibbonPermissionPosition</span><span class="hl-1">]</span><br/><span class="hl-1">);</span><br/><span class="hl-9">// canEdit === true</span>
</code><button type="button">Copy</button></pre>

<h2 id="using-your-own-mongoclient" class="tsd-anchor-link">Using Your Own MongoClient<a href="#using-your-own-mongoclient" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can inject an existing <code>MongoClient</code> instead of a URI. This lets you create sessions from your own client and pass them to any method for transactional control:</p>
<pre><code class="typescript"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">MongoClient</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&quot;mongodb&quot;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">GibbonsMongoDb</span><span class="hl-1">, </span><span class="hl-7">ConfigLoader</span><span class="hl-1">, </span><span class="hl-7">withTransaction</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@icazemier/gibbons-mongodb&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">MongoClient</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">(</span><span class="hl-2">&quot;mongodb://localhost:27017&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">config</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">ConfigLoader</span><span class="hl-1">.</span><span class="hl-0">load</span><span class="hl-1">();</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">gibbonsDb</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">GibbonsMongoDb</span><span class="hl-1">(</span><span class="hl-7">client</span><span class="hl-1">, </span><span class="hl-7">config</span><span class="hl-1">);</span><br/><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">initialize</span><span class="hl-1">();</span><br/><br/><span class="hl-9">// Wrap multiple operations in a single transaction</span><br/><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">withTransaction</span><span class="hl-1">(</span><span class="hl-7">client</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-7">session</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">perm</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">allocatePermission</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;reports.view&quot;</span><span class="hl-1"> }, </span><span class="hl-7">session</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">group</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">allocateGroup</span><span class="hl-1">({ </span><span class="hl-7">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;Viewers&quot;</span><span class="hl-1"> }, </span><span class="hl-7">session</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">gibbonsDb</span><span class="hl-1">.</span><span class="hl-0">subscribePermissionsToGroups</span><span class="hl-1">(</span><br/><span class="hl-1">        [</span><span class="hl-7">group</span><span class="hl-1">.</span><span class="hl-7">gibbonGroupPosition</span><span class="hl-1">],</span><br/><span class="hl-1">        [</span><span class="hl-7">perm</span><span class="hl-1">.</span><span class="hl-7">gibbonPermissionPosition</span><span class="hl-1">],</span><br/><span class="hl-1">        </span><span class="hl-7">session</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Every public method accepts an optional <code>session</code> parameter. When omitted, multi-step methods automatically use an internal transaction.</p>
<h2 id="api-overview" class="tsd-anchor-link">API Overview<a href="#api-overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="permissions" class="tsd-anchor-link">Permissions<a href="#permissions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocatePermission(data, session?)</code></td>
<td>Allocate a new permission slot</td>
</tr>
<tr>
<td><code>deallocatePermissions(positions, session?)</code></td>
<td>Deallocate and remove from groups/users</td>
</tr>
<tr>
<td><code>updatePermissionMetadata(position, data, session?)</code></td>
<td>Update custom fields</td>
</tr>
<tr>
<td><code>findPermissions(positions)</code></td>
<td>Find by positions</td>
</tr>
<tr>
<td><code>findAllAllocatedPermissions()</code></td>
<td>List all allocated</td>
</tr>
<tr>
<td><code>validateAllocatedPermissions(positions)</code></td>
<td>Check if allocated in DB</td>
</tr>
</tbody>
</table>
<h3 id="groups" class="tsd-anchor-link">Groups<a href="#groups" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allocateGroup(data, session?)</code></td>
<td>Allocate a new group slot</td>
</tr>
<tr>
<td><code>deallocateGroups(positions, session?)</code></td>
<td>Deallocate and remove from users</td>
</tr>
<tr>
<td><code>updateGroupMetadata(position, data, session?)</code></td>
<td>Update custom fields</td>
</tr>
<tr>
<td><code>subscribePermissionsToGroups(groups, perms, session?)</code></td>
<td>Add permissions to groups</td>
</tr>
<tr>
<td><code>unsubscribePermissionsFromGroups(groups, perms, session?)</code></td>
<td>Remove permissions from groups</td>
</tr>
<tr>
<td><code>findGroups(positions)</code></td>
<td>Find by positions</td>
</tr>
<tr>
<td><code>findGroupsByPermissions(positions)</code></td>
<td>Find groups that have certain permissions</td>
</tr>
<tr>
<td><code>findAllAllocatedGroups()</code></td>
<td>List all allocated</td>
</tr>
<tr>
<td><code>validateAllocatedGroups(positions)</code></td>
<td>Check if allocated in DB</td>
</tr>
</tbody>
</table>
<h3 id="users" class="tsd-anchor-link">Users<a href="#users" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>createUser(data, session?)</code></td>
<td>Create with empty gibbons</td>
</tr>
<tr>
<td><code>removeUser(filter, session?)</code></td>
<td>Delete by filter</td>
</tr>
<tr>
<td><code>subscribeUsersToGroups(filter, groups, session?)</code></td>
<td>Add users to groups</td>
</tr>
<tr>
<td><code>unsubscribeUsersFromGroups(filter, groups, session?)</code></td>
<td>Remove users from groups</td>
</tr>
<tr>
<td><code>findUsers(filter)</code></td>
<td>Query by MongoDB filter</td>
</tr>
<tr>
<td><code>findUsersByGroups(positions)</code></td>
<td>Find by group membership</td>
</tr>
<tr>
<td><code>findUsersByPermissions(positions)</code></td>
<td>Find by permission</td>
</tr>
<tr>
<td><code>updateUserMetadata(filter, data, session?)</code></td>
<td>Update custom fields</td>
</tr>
</tbody>
</table>
<h3 id="validation-synchronous-no-db-call" class="tsd-anchor-link">Validation (synchronous, no DB call)<a href="#validation-synchronous-no-db-call" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>validateUserPermissionsForAllPermissions(userPerms, perms)</code></td>
<td>Has ALL permissions?</td>
</tr>
<tr>
<td><code>validateUserPermissionsForAnyPermissions(userPerms, perms)</code></td>
<td>Has ANY permission?</td>
</tr>
<tr>
<td><code>validateUserGroupsForAllGroups(userGroups, groups)</code></td>
<td>In ALL groups?</td>
</tr>
<tr>
<td><code>validateUserGroupsForAnyGroups(userGroups, groups)</code></td>
<td>In ANY group?</td>
</tr>
</tbody>
</table>
<h3 id="utilities" class="tsd-anchor-link">Utilities<a href="#utilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Method/Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getMongoClient()</code></td>
<td>Get the underlying MongoClient</td>
</tr>
<tr>
<td><code>getPermissionsGibbonForGroups(groups)</code></td>
<td>Aggregate permissions from groups</td>
</tr>
<tr>
<td><code>withTransaction(client, fn)</code></td>
<td>Run a callback inside a MongoDB transaction</td>
</tr>
</tbody>
</table>
<h2 id="config-options" class="tsd-anchor-link">Config Options<a href="#config-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dbName</code></td>
<td>string</td>
<td>MongoDB database name</td>
</tr>
<tr>
<td><code>permissionByteLength</code></td>
<td>number</td>
<td>Bytes for permissions (256 = 2,048 slots)</td>
</tr>
<tr>
<td><code>groupByteLength</code></td>
<td>number</td>
<td>Bytes for groups (256 = 2,048 slots)</td>
</tr>
<tr>
<td><code>mongoDbMutationConcurrency</code></td>
<td>number</td>
<td>Concurrency limit for bulk operations</td>
</tr>
<tr>
<td><code>dbStructure.user.collectionName</code></td>
<td>string</td>
<td>User collection (can be existing)</td>
</tr>
<tr>
<td><code>dbStructure.group.collectionName</code></td>
<td>string</td>
<td>Group collection (managed by Gibbons)</td>
</tr>
<tr>
<td><code>dbStructure.permission.collectionName</code></td>
<td>string</td>
<td>Permission collection (managed by Gibbons)</td>
</tr>
</tbody>
</table>
<p>Config is loaded via <a href="https://github.com/davidtheclark/cosmiconfig">cosmiconfig</a>, so <code>.gibbons-mongodbrc.json</code>, <code>.yaml</code>, or a <code>gibbons-mongodb</code> key in <code>package.json</code> all work.</p>
<h2 id="faq" class="tsd-anchor-link">FAQ<a href="#faq" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><strong>What is this?</strong>
A permissions library. It stores group memberships and permissions as compact bitmasks in MongoDB, using <code>$bitsAnySet</code> / <code>$bitsAllSet</code> for fast queries.</p>
<p><strong>What is this NOT?</strong>
An ORM, an authentication solution, or a user management system. It only manages the group/permission layer.</p>
<p><strong>Can I use an existing user collection?</strong>
Yes. Gibbons adds <code>groupsGibbon</code> and <code>permissionsGibbon</code> fields without touching your other fields.</p>
<p><strong>How many permissions/groups can I have?</strong>
<code>byteLength * 8</code>. So 256 bytes = 2,048, 1024 bytes = 8,192.</p>
<p><strong>Can I change byte lengths later?</strong>
Yes. Use <code>expandPermissions</code> / <code>expandGroups</code> to grow, or <code>shrinkPermissions</code> / <code>shrinkGroups</code> to reduce. These methods re-seed slots, pad or truncate existing Binary fields, and update the config â€” all inside a transaction.</p>
<p><strong>Do I need a replica set for transactions?</strong>
Yes. MongoDB transactions require a replica set (or sharded cluster). Standalone servers don't support them, but you can still use all methods without the <code>session</code> parameter.</p>
<p><strong>Can I pass my own MongoClient?</strong>
Yes. <code>new GibbonsMongoDb(myClient, config)</code> reuses your client, so sessions you create from it work with all facade methods.</p>
<p><strong>How do transactions work?</strong>
Multi-step methods (deallocate, subscribe, unsubscribe) auto-wrap in a transaction when no <code>session</code> is passed. To combine multiple calls in one transaction, pass your own <code>session</code>.</p>
<p><strong>What happens when all slots are used?</strong>
<code>allocatePermission</code> / <code>allocateGroup</code> throws. Use <code>expandPermissions</code> / <code>expandGroups</code> to increase capacity at runtime.</p>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>MIT</p>
<h2 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Issues and PRs welcome at <a href="https://github.com/icazemier/gibbons-mongodb">github.com/icazemier/gibbons-mongodb</a>.</p>
<p>This project uses <a href="https://www.conventionalcommits.org/">conventional commits</a> with automated semantic versioning. See <a href="media/SEMANTIC-VERSIONING-QUICKSTART.md">SEMANTIC-VERSIONING-QUICKSTART.md</a> for details.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#gibbons-for-mongodb"><span>Gibbons for <wbr/>Mongo<wbr/>DB</span></a><ul><li><a href="#install"><span>Install</span></a></li><li><a href="#quick-start"><span>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#1-create-a-config-file"><span>1. <wbr/>Create a config file</span></a></li><li><a href="#2-seed-the-database"><span>2. <wbr/>Seed the database</span></a></li><li><a href="#3-use-it"><span>3. <wbr/>Use it</span></a></li></ul></li><li><a href="#using-your-own-mongoclient"><span>Using <wbr/>Your <wbr/>Own <wbr/>Mongo<wbr/>Client</span></a></li><li><a href="#api-overview"><span>API <wbr/>Overview</span></a></li><li><ul><li><a href="#permissions"><span>Permissions</span></a></li><li><a href="#groups"><span>Groups</span></a></li><li><a href="#users"><span>Users</span></a></li><li><a href="#validation-synchronous-no-db-call"><span>Validation (synchronous, no <wbr/>DB call)</span></a></li><li><a href="#utilities"><span>Utilities</span></a></li></ul></li><li><a href="#config-options"><span>Config <wbr/>Options</span></a></li><li><a href="#faq"><span>FAQ</span></a></li><li><a href="#license"><span>License</span></a></li><li><a href="#contributing"><span>Contributing</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@icazemier/gibbons-mongodb</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
